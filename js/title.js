var S={init:function(){var A=window.location.href,B=A.indexOf("?a=");S.Drawing.init(".canvas");document.body.classList.add("body--ready");if(B!==-1){S.UI.simulate(decodeURI(A).substring(B+3))}else{S.UI.simulate("厚德|笃学|崇实|尚新|百科知识竞赛")}S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=(function(){var B,A,C;requestFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(D){window.setTimeout(D,1000/60)};return{init:function(D){B=document.querySelector(D);A=B.getContext("2d");this.adjustCanvas();window.addEventListener("resize",function(E){S.Drawing.adjustCanvas()})},loop:function(D){C=!C?D:C;this.clearFrame();C();requestFrame.call(window,this.loop.bind(this))},adjustCanvas:function(){B.width=window.innerWidth;B.height=window.innerHeight/2},clearFrame:function(){A.clearRect(0,0,B.width,B.height)},getArea:function(){return{w:B.width,h:B.height}},drawCircle:function(D,E){A.fillStyle=E.render();A.beginPath();A.arc(D.x,D.y,D.z,0,2*Math.PI,true);A.closePath();A.fill()}}}());S.UI=(function(){var L=document.querySelector(".ui-input"),C=document.querySelector(".ui"),R=document.querySelector(".help"),Y=document.querySelector(".commands"),E=document.querySelector(".overlay"),A=document.querySelector(".canvas"),N,G=false,Q,P,I,K=30,U=true,T=[],O="#";function V(b){var Z=b.getHours(),a=b.getMinutes(),a=a<10?"0"+a:a;return Z+":"+a}function F(Z){return Z&&Z.split(" ")[1]}function W(Z){Z=Z&&Z.split(" ")[0];return Z&&Z[0]===O&&Z.substring(1)}function D(a,b,c,Z){clearInterval(N);Q=Z?c:1;a(Q);if(!c||(!Z&&Q<c)||(Z&&Q>0)){N=setInterval(function(){Q=Z?Q-1:Q+1;a(Q);if((!Z&&c&&Q===c)||(Z&&Q===0)){clearInterval(N)}},b)}}function B(Z){clearInterval(N);T=[];I=null;Z&&S.Shape.switchShape(S.ShapeBuilder.letter(""))}function H(b){var Z,b,a;E.classList.remove("overlay--visible");T=typeof(b)==="object"?b:T.concat(b.split("|"));L.value="";M();D(function(c){a=T.shift();Z=W(a);b=F(a);switch(Z){case"countdown":b=parseInt(b)||10;b=b>0?b:10;D(function(f){if(f===0){if(T.length===0){S.Shape.switchShape(S.ShapeBuilder.letter(""))}else{H(T)}}else{S.Shape.switchShape(S.ShapeBuilder.letter(f),true)}},1000,b,true);break;case"rectangle":b=b&&b.split("x");b=(b&&b.length===2)?b:[K,K/2];S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(K,parseInt(b[0])),Math.min(K,parseInt(b[1]))));break;case"circle":b=parseInt(b)||K;b=Math.min(b,K);S.Shape.switchShape(S.ShapeBuilder.circle(b));break;case"time":var e=V(new Date());if(T.length>0){S.Shape.switchShape(S.ShapeBuilder.letter(e))}else{D(function(){e=V(new Date());if(e!==I){I=e;S.Shape.switchShape(S.ShapeBuilder.letter(I))}},1000)}break;default:S.Shape.switchShape(S.ShapeBuilder.letter(a[0]===O?"What?":a))}},2000,T.length)}function M(Z){if(L.value.length>18){C.classList.add("ui--wide")}else{C.classList.remove("ui--wide")}if(U&&L.value.length>0){C.classList.add("ui--enter")}else{C.classList.remove("ui--enter")}}function J(){document.body.addEventListener("keydown",function(Z){L.focus();if(Z.keyCode===13){U=false;B();H(L.value)}});L.addEventListener("input",M);L.addEventListener("change",M);L.addEventListener("focus",M);R.addEventListener("click",function(Z){E.classList.toggle("overlay--visible");E.classList.contains("overlay--visible")&&B(true)});Y.addEventListener("click",function(a){var Z,g,i,b,f,c;if(a.target.classList.contains("commands-item")){Z=a.target}else{Z=a.target.parentNode.classList.contains("commands-item")?a.target.parentNode:a.target.parentNode.parentNode}g=Z&&Z.querySelector(".commands-item-info");i=Z&&g.getAttribute("data-demo");c=Z&&g.getAttribute("data-url");if(g){E.classList.remove("overlay--visible");if(i){L.value=i;if(G){B();H(L.value)}else{L.focus()}}else{if(c){}}}});A.addEventListener("click",function(Z){E.classList.remove("overlay--visible")})}function X(){J();L.focus();G&&document.body.classList.add("touch")}X();return{simulate:function(Z){H(Z)}}}());S.UI.Tabs=(function(){var D=document.querySelector(".tabs"),G=document.querySelector(".tabs-labels"),F=document.querySelectorAll(".tabs-label"),E=document.querySelectorAll(".tabs-panel");function C(H){F[H].classList.add("tabs-label--active");E[H].classList.add("tabs-panel--active")}function A(){G.addEventListener("click",function(I){var H=I.target,J;if(H.classList.contains("tabs-label")){for(var K=0;K<F.length;K++){F[K].classList.remove("tabs-label--active");E[K].classList.remove("tabs-panel--active");if(H===F[K]){J=K}}C(J)}})}function B(){C(0);A()}B()}());S.Point=function(A){this.x=A.x;this.y=A.y;this.z=A.z;this.a=A.a;this.h=A.h};S.Color=function(B,A,C,D){this.r=B;this.g=A;this.b=C;this.a=D};S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}};S.Dot=function(A,B){this.p=new S.Point({x:A,y:B,z:5,a:1,h:0});this.e=0.07;this.s=true;this.c=new S.Color(255,255,255,this.p.a);this.t=this.clone();this.q=[]};S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a;S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(B){var D=this.distanceTo(B,true),C=D[0],E=D[1],A=D[2],F=this.e*A;if(this.p.h===-1){this.p.x=B.x;this.p.y=B.y;return true}if(A>1){this.p.x-=((C/A)*F);this.p.y-=((E/A)*F)}else{if(this.p.h>0){this.p.h--}else{return true}}return false},_update:function(){if(this._moveTowards(this.t)){var A=this.q.shift();if(A){this.t.x=A.x||this.p.x;this.t.y=A.y||this.p.y;this.t.z=A.z||this.p.z;this.t.a=A.a||this.p.a;this.p.h=A.h||0}else{if(this.s){this.p.x-=Math.sin(Math.random()*3.142);this.p.y-=Math.sin(Math.random()*3.142)}else{this.move(new S.Point({x:this.p.x+(Math.random()*50)-25,y:this.p.y+(Math.random()*50)-25,}))}}}d=this.p.a-this.t.a;this.p.a=Math.max(0.1,this.p.a-(d*0.05));d=this.p.z-this.t.z;this.p.z=Math.max(1,this.p.z-(d*0.05))},distanceTo:function(B,D){var C=this.p.x-B.x,E=this.p.y-B.y,A=Math.sqrt(C*C+E*E);return D?[C,E,A]:A},move:function(A,B){if(!B||(B&&this.distanceTo(A)>1)){this.q.push(A)}},render:function(){this._update();this._draw()}};S.ShapeBuilder=(function(){var J=13,A=document.createElement("canvas"),I=A.getContext("2d"),C=500,F="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";function E(){A.width=Math.floor(window.innerWidth/J)*J;A.height=Math.floor(window.innerHeight/J)*J;I.fillStyle="red";I.textBaseline="middle";I.textAlign="center"}function H(){var K=I.getImageData(0,0,A.width,A.height).data;dots=[],K,x=0,y=0,fx=A.width,fy=A.height,w=0,h=0;for(var L=0;L<K.length;L+=(4*J)){if(K[L+3]>0){dots.push(new S.Point({x:x,y:y}));w=x>w?x:w;h=y>h?y:h;fx=x<fx?x:fx;fy=y<fy?y:fy}x+=J;if(x>=A.width){x=0;y+=J;L+=J*4*A.width}}return{dots:dots,w:w+fx,h:h+fy}}function B(K){I.font="bold "+K+"px "+F}function G(K){return !isNaN(parseFloat(K))&&isFinite(K)}function D(){E();window.addEventListener("resize",E)}D();return{imageFile:function(L,K){var M=new Image(),N=S.Drawing.getArea();M.onload=function(){I.clearRect(0,0,A.width,A.height);I.drawImage(this,0,0,N.h*0.6,N.h*0.6);K(H())};M.onerror=function(){K(S.ShapeBuilder.letter("What?"))};M.src=L},circle:function(K){var L=Math.max(0,K)/2;I.clearRect(0,0,A.width,A.height);I.beginPath();I.arc(L*J,L*J,L*J,0,2*Math.PI,false);I.fill();I.closePath();return H()},letter:function(L){var K=0;B(C);K=Math.min(C,(A.width/I.measureText(L).width)*0.8*C,(A.height/C)*(G(L)?1:0.45)*C);B(K);I.clearRect(0,0,A.width,A.height);I.fillText(L,A.width/2,A.height/2);return H()},rectangle:function(N,K){var M=[],P=J*N,L=J*K;for(var O=0;O<L;O+=J){for(var Q=0;Q<P;Q+=J){M.push(new S.Point({x:Q,y:O,}))}}return{dots:M,w:P,h:L}}}}());S.Shape=(function(){var B=[],E=0,A=0,F=0,C=0;function D(){var G=S.Drawing.getArea();F=G.w/2-E/2;C=G.h/2-A/2}return{shuffleIdle:function(){var H=S.Drawing.getArea();for(var G=0;G<B.length;G++){if(!B[G].s){B[G].move({x:Math.random()*H.w,y:Math.random()*H.h})}}},switchShape:function(I,K){var G,L=S.Drawing.getArea();E=I.w;A=I.h;D();if(I.dots.length>B.length){G=I.dots.length-B.length;for(var H=1;H<=G;H++){B.push(new S.Dot(L.w/2,L.h/2))}}var H=0,J=0;while(I.dots.length>0){J=Math.floor(Math.random()*I.dots.length);B[H].e=K?0.25:(B[H].s?0.14:0.11);if(B[H].s){B[H].move(new S.Point({z:Math.random()*20+10,a:Math.random(),h:18}))}else{B[H].move(new S.Point({z:Math.random()*5+5,h:K?18:30}))}B[H].s=true;B[H].move(new S.Point({x:I.dots[J].x+F,y:I.dots[J].y+C,a:1,z:5,h:0}));I.dots=I.dots.slice(0,J).concat(I.dots.slice(J+1));H++}for(var J=H;J<B.length;J++){if(B[J].s){B[J].move(new S.Point({z:Math.random()*20+10,a:Math.random(),h:20}));B[J].s=false;B[J].e=0.04;B[J].move(new S.Point({x:Math.random()*L.w,y:Math.random()*L.h,a:0.3,z:Math.random()*4,h:0}))}}},render:function(){for(var G=0;G<B.length;G++){B[G].render()}}}}());S.init();
